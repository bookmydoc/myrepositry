/*------------------------------------------------------------------------
 # Module - Flexible - Virtuemart Zoom Effect on Product Page - Version 1.0
 # ------------------------------------------------------------------------
 # Copyright (C) 2011 Flexible Web Design. All Rights Reserved.
 # @license http://www.gnu.org/licenses/gpl-3.0.html GNU/GPLv3
 # Author: Flexible Web Design Team
 # Websites: http://www.flexiblewebdesign.com
 -------------------------------------------------------------------------*/
var jQuery_1_5_2 = $.noConflict(true);(function(jQuery_1_5_2){function flexibleZoom(a,b){var c=jQuery_1_5_2("img",a);var d;var e;var f=null;var g=null;var h=null;var i=null;var j=null;var k=null;var l;var m=0;var n,o;var p=0;var q=0;var r=0;var s=0;var t=0;var u,v;var w=this,x;setTimeout(function(){if(g===null){var b=a.width();a.parent().append(format('<div style="width:%0px;position:absolute;top:75%;left:%1px;text-align:center" class="flexible-zoom-loading" >loading...</div>',b/3,b/2-b/6)).find(":last").css("opacity",.5)}},200);var y=function(){if(k!==null){k.remove();k=null}};this.removeBits=function(){if(h){h.remove();h=null}if(i){i.remove();i=null}if(j){j.remove();j=null}y();jQuery_1_5_2(".flexible-zoom-loading",a.parent()).remove()};this.destroy=function(){a.data("zoom",null);if(g){g.unbind();g.remove();g=null}if(f){f.remove();f=null}this.removeBits()};this.fadedOut=function(){if(f){f.remove();f=null}this.removeBits()};this.controlLoop=function(){if(h){var a=u-c.offset().left-n*.5>>0;var d=v-c.offset().top-o*.5>>0;if(a<0){a=0}else if(a>c.outerWidth()-n){a=c.outerWidth()-n}if(d<0){d=0}else if(d>c.outerHeight()-o){d=c.outerHeight()-o}h.css({left:a,top:d});h.css("background-position",-a+"px "+ -d+"px");p=a/c.outerWidth()*l.width>>0;q=d/c.outerHeight()*l.height>>0;s+=(p-s)/b.smoothMove;r+=(q-r)/b.smoothMove;f.css("background-position",-(s>>0)+"px "+(-(r>>0)+"px"))}m=setTimeout(function(){w.controlLoop()},30)};this.init2=function(a,b){t++;if(b===1){l=a}if(t===2){this.init()}};this.init=function(){jQuery_1_5_2(".flexible-zoom-loading",a.parent()).remove();g=a.parent().append(format("<div class='mousetrap' style='background-image:url(\".\");z-index:999;position:absolute;width:%0px;height:%1px;left:%2px;top:%3px;'></div>",c.outerWidth(),c.outerHeight(),0,0)).find(":last");g.bind("mousemove",this,function(a){u=a.pageX;v=a.pageY});g.bind("mouseleave",this,function(a){clearTimeout(m);if(h){h.fadeOut(299)}if(i){i.fadeOut(299)}if(j){j.fadeOut(299)}f.fadeOut(300,function(){w.fadedOut()});return false});g.bind("mouseenter",this,function(d){u=d.pageX;v=d.pageY;x=d.data;if(f){f.stop(true,false);f.remove()}var e=b.adjustX,m=b.adjustY;var p=c.outerWidth();var q=c.outerHeight();var r=b.zoomWidth;var s=b.zoomHeight;if(b.zoomWidth=="auto"){r=p}if(b.zoomHeight=="auto"){s=q}var t=a.parent();switch(b.position){case"top":m-=s;break;case"right":e+=p;break;case"bottom":m+=q;break;case"left":e-=r;break;case"inside":r=p;s=q;break;default:t=jQuery_1_5_2("#"+b.position);if(!t.length){t=a;e+=p;m+=q}else{r=t.innerWidth();s=t.innerHeight()}}f=t.append(format('<div id="flexible-zoom-big" class="flexible-zoom-big" style="display:none;position:absolute;left:%0px;top:%1px;width:%2px;height:%3px;background:url(\'%4\') no-repeat #ffffff;z-index:99;"></div>',e,m,r,s,l.src)).find(":last");if(c.attr("title")&&b.showTitle){f.append(format('<div class="flexible-zoom-title">%0</div>',c.attr("title"))).find(":last").css("opacity",b.titleOpacity)}if(jQuery_1_5_2.browser.msie&&jQuery_1_5_2.browser.version<7){k=jQuery_1_5_2('<iframe frameborder="0" src="#"></iframe>').css({position:"absolute",left:e,top:m,zIndex:99,width:r,height:s}).insertBefore(f)}f.fadeIn(500);if(h){h.remove();h=null}n=c.outerWidth()/l.width*f.width();o=c.outerHeight()/l.height*f.height();h=a.append(format("<div class = 'flexible-zoom-lens' style='display:none;z-index:98;position:absolute;width:%0px;height:%1px;'></div>",n,o)).find(":last");g.css("cursor",h.css("cursor"));var w=false;if(b.tint){h.css("background",'url("'+c.attr("src")+'")');i=a.append(format('<div style="display:none;position:absolute; left:0px; top:0px; width:%0px; height:%1px; background-color:%2;" />',c.outerWidth(),c.outerHeight(),b.tint)).find(":last");i.css("opacity",b.tintOpacity);w=true;i.fadeIn(500)}if(b.softFocus){h.css("background",'url("'+c.attr("src")+'")');j=a.append(format('<div style="position:absolute;display:none;top:2px; left:2px; width:%0px; height:%1px;" />',c.outerWidth()-2,c.outerHeight()-2,b.tint)).find(":last");j.css("background",'url("'+c.attr("src")+'")');j.css("opacity",.5);w=true;j.fadeIn(500)}if(!w){h.css("opacity",b.lensOpacity)}if(b.position!=="inside"){h.fadeIn(500)}x.controlLoop();return})};d=new Image;jQuery_1_5_2(d).load(function(){w.init2(this,0)});d.src=c.attr("src");e=new Image;jQuery_1_5_2(e).load(function(){w.init2(this,1)});e.src=a.attr("href")}function format(a){for(var b=1;b<arguments.length;b++){a=a.replace("%"+(b-1),arguments[b])}return a}jQuery_1_5_2(document).ready(function(){jQuery_1_5_2(".flexible-zoom, .flexible-zoom-gallery").flexibleZoom()});jQuery_1_5_2.fn.flexibleZoom=function(options){try{document.execCommand("BackgroundImageCache",false,true)}catch(e){}this.each(function(){var relOpts,opts;eval("var\ta = {"+jQuery_1_5_2(this).attr("rel")+"}");relOpts=a;if(jQuery_1_5_2(this).is(".flexible-zoom")){jQuery_1_5_2(this).css({position:"relative",display:"block"});jQuery_1_5_2("img",jQuery_1_5_2(this)).css({display:"block"});if(jQuery_1_5_2(this).parent().attr("id")!="wrap"){jQuery_1_5_2(this).wrap('<div id="wrap" style="top:0px;z-index:9;position:relative;"></div>')}opts=jQuery_1_5_2.extend({},jQuery_1_5_2.fn.flexibleZoom.defaults,options);opts=jQuery_1_5_2.extend({},opts,relOpts);jQuery_1_5_2(this).data("zoom",new flexibleZoom(jQuery_1_5_2(this),opts))}else if(jQuery_1_5_2(this).is(".flexible-zoom-gallery")){opts=jQuery_1_5_2.extend({},relOpts,options);jQuery_1_5_2(this).data("relOpts",opts);jQuery_1_5_2(this).bind("click",jQuery_1_5_2(this),function(a){var b=a.data.data("relOpts");jQuery_1_5_2("#"+b.useZoom).data("zoom").destroy();jQuery_1_5_2("#"+b.useZoom).attr("href",a.data.attr("href"));jQuery_1_5_2("#"+b.useZoom+" img").attr("src",a.data.data("relOpts").smallImage);jQuery_1_5_2("#"+a.data.data("relOpts").useZoom).flexibleZoom();return false})}});return this};jQuery_1_5_2.fn.flexibleZoom.defaults={zoomWidth:"370",zoomHeight:"370",position:"right",tint:false,tintOpacity:.5,lensOpacity:.5,softFocus:false,smoothMove:3,showTitle:true,titleOpacity:.5,adjustX:0,adjustY:0}})(jQuery_1_5_2)